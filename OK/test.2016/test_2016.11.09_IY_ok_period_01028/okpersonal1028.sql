drop trigger IY01028.TR_OK_PERSONAL_HIST;

alter table OK_PERSONAL
  drop constraint OK_PERSONAL_PK;
drop index  OK_PERSONAL_PK;

alter table OK_PERSONAL
  drop constraint OK_PERSONAL_UK;
drop index  OK_PERSONAL_UK;

alter table OK_PERSONAL
  drop constraint OK_PERSONAL_CHK_CODE;

drop index OK_PERSONAL_PASSPORT;




drop table ok_personal_old;
alter table ok_personal rename to ok_personal_old;
create table ok_personal as select * from IY00444.ok_personal where rownum<1;
commit;
insert into IY01028.ok_personal (
ID,
BRANCH,
PERSONAL_CODE,
COLLEAGUE_CODE,
STATUS_CODE,
SALARY_CODE,
FAMILY,
FIRST_NAME,
PATRONYMIC,
GENDER_CODE,
BIRTHDAY,
REGION_ID,
DISTR,
NATIONALITY_CODE,
FAMILY_STATUS_CODE,
REG_TYPE_CODE,
HOME_ADDRESS,
HOME_ADDRESSFACT,
PASS_SERIYA,
PASS_NUM,
PASS_DATE,
PASS_REG,
RECORD_BOOK_NUMBER,
RECORD_BOOK_SERIES,
TELEFON,
EMP_CODE,
INS_DATE,
PROFMEMBER,
TABNO,
EDUCATION_TITLE_CODE,
BIRTHPLACE,
MOTIVE_OUT,
BASIS_NUM,
BASIS_DATE,
LEAVE_CODE,
DEPARTMENT_CODE,
POST_CODE,
NN,
MOTIVE_DISMISSIAL_CODE,
NPS_ID,
SPECIAL_CODE,
COD_DISTR_UVD,
COD_DISTR_PRIM,
COD_STR_BIRTH,
COD_OBL_PRIM,
COD_PLACE_BIRTH_PRIM,
COD_SITIZENT,
COD_STR_SITIZENT,
COD_STR_LIVE,
COD_OBL_LIVE,
COD_OBL_LIVE_PRIM,
COD_DISTR_LIVE,
COD_DISTR_LIVE_PRIM,
CODE_NACI_PRIM,
CHECK_KFS,
IS_BOSS,
BANK_SPEC,
NOTICE,
PRICH_ID,
NAME_PR,
INN,
SROK_DATE,
HOME_ADDRESSFACT_REGION_ID,
HOME_ADDRESSFACT_DISTR,
HOME_ADDRESS_REGION_ID,
HOME_ADDRESS_DISTR,
PASSPORT_TYPE_CODE,
REGPLACE_CODE,
PASS_DATE_END,
GOSUBMIT_CODE,
LIVE_PLACE,
BIRTHPLACE_POINT,
MAIDEN_FAMILY,
DEPARTMENT_CODE_OLD,
POST_CODE_OLD,
SPECIAL_CODE_OLD,
SPEC_IKKI,
DEPARTMENT_CODE_NEW,
POST_CODE_NEW,
SPECIAL_CODE_NEW,
REG_DATE_END,
TRUD_SOGL,
APPLICATION_DATE,
REPLY_DATE,
USER_NAME,
IS_PARTY,
IS_ACADEMIC,
IS_DEGREE,
IS_AWARD,
IS_SCIENTIFIC,
IS_VOYAGE,
IS_CONVICTIONS,
IS_LANGUAGE,
IS_RISE,
IS_ELECTION,
IS_PREMIUM,
IS_ARMY,
MAIDENSTAG,
ZP_RATE_CODE,
FAMILY_LAT,
FIRST_NAME_LAT,
PATRONYMIC_LAT,
COMMENTS
) select
ID,
BRANCH,
PERSONAL_CODE,
COLLEAGUE_CODE,
STATUS_CODE,
SALARY_CODE,
FAMILY,
FIRST_NAME,
PATRONYMIC,
GENDER_CODE,
BIRTHDAY,
REGION_ID,
DISTR,
NATIONALITY_CODE,
FAMILY_STATUS_CODE,
REG_TYPE_CODE,
HOME_ADDRESS,
HOME_ADDRESSFACT,
PASS_SERIYA,
PASS_NUM,
PASS_DATE,
PASS_REG,
RECORD_BOOK_NUMBER,
RECORD_BOOK_SERIES,
TELEFON,
EMP_CODE,
INS_DATE,
PROFMEMBER,
TABNO,
EDUCATION_TITLE_CODE,
BIRTHPLACE,
MOTIVE_OUT,
BASIS_NUM,
BASIS_DATE,
LEAVE_CODE,
DEPARTMENT_CODE,
POST_CODE,
NN,
MOTIVE_DISMISSIAL_CODE,
NPS_ID,
SPECIAL_CODE,
COD_DISTR_UVD,
COD_DISTR_PRIM,
COD_STR_BIRTH,
COD_OBL_PRIM,
COD_PLACE_BIRTH_PRIM,
COD_SITIZENT,
COD_STR_SITIZENT,
COD_STR_LIVE,
COD_OBL_LIVE,
COD_OBL_LIVE_PRIM,
COD_DISTR_LIVE,
COD_DISTR_LIVE_PRIM,
CODE_NACI_PRIM,
CHECK_KFS,
IS_BOSS,
BANK_SPEC,
NOTICE,
PRICH_ID,
NAME_PR,
INN,
SROK_DATE,
HOME_ADDRESSFACT_REGION_ID,
HOME_ADDRESSFACT_DISTR,
HOME_ADDRESS_REGION_ID,
HOME_ADDRESS_DISTR,
PASSPORT_TYPE_CODE,
REGPLACE_CODE,
PASS_DATE_END,
GOSUBMIT_CODE,
LIVE_PLACE,
BIRTHPLACE_POINT,
MAIDEN_FAMILY,
DEPARTMENT_CODE_OLD,
POST_CODE_OLD,
SPECIAL_CODE_OLD,
SPEC_IKKI,
DEPARTMENT_CODE_NEW,
POST_CODE_NEW,
SPECIAL_CODE_NEW,
REG_DATE_END,
TRUD_SOGL,
APPLICATION_DATE,
REPLY_DATE,
USER_NAME,
IS_PARTY,
IS_ACADEMIC,
IS_DEGREE,
IS_AWARD,
IS_SCIENTIFIC,
IS_VOYAGE,
IS_CONVICTIONS,
IS_LANGUAGE,
IS_RISE,
IS_ELECTION,
IS_PREMIUM,
IS_ARMY,
MAIDENSTAG,
ZP_RATE_CODE,
FAMILY_LAT,
FIRST_NAME_LAT,
PATRONYMIC_LAT,
COMMENTS
from IY01028.ok_personal_old;

commit;

alter table OK_PERSONAL
  add constraint OK_PERSONAL_PK primary key (BRANCH, PERSONAL_CODE);

alter table OK_PERSONAL
  add constraint OK_PERSONAL_UK unique (BRANCH, ID);

alter table OK_PERSONAL
  add constraint OK_PERSONAL_CHK_CODE
  check (personal_code>0);

create index OK_PERSONAL_PASSPORT on OK_PERSONAL (BRANCH, PASS_NUM, PASS_SERIYA);


